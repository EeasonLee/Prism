#!/bin/sh

# æ£€æµ‹æ˜¯å¦åœ¨ WSL ç¯å¢ƒä¸­ï¼ˆé€šè¿‡æ£€æŸ¥ /proc/version æˆ– WSL_DISTRO_NAMEï¼‰
# å¦‚æœåœ¨ WSL ä¸­ï¼Œè¿‡æ»¤æ‰ Windows è·¯å¾„ï¼ˆ/mnt/ å¼€å¤´ï¼‰ï¼Œé¿å…ä½¿ç”¨ Windows çš„ pnpm
if [ -n "$WSL_DISTRO_NAME" ] || grep -qi microsoft /proc/version 2>/dev/null; then
  # WSL ç¯å¢ƒï¼šè¿‡æ»¤æ‰ Windows è·¯å¾„ï¼Œä¼˜å…ˆä½¿ç”¨ WSL æœ¬åœ°è·¯å¾„
  export PATH=$(echo "$PATH" | tr ':' '\n' | grep -v '^/mnt/' | tr '\n' ':' | sed 's/:$//')
  
  # ç¡®ä¿ WSL ä¸­çš„ pnpm è·¯å¾„åœ¨ PATH ä¸­ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
  if [ -d "$HOME/.volta/bin" ] && ! echo "$PATH" | grep -q "$HOME/.volta/bin"; then
    export PATH="$HOME/.volta/bin:$PATH"
  fi
fi

# å¦‚æœ pnpm ä»ç„¶æ‰¾ä¸åˆ°ï¼Œå°è¯•ä½¿ç”¨å¸¸è§çš„è·¯å¾„
if ! command -v pnpm >/dev/null 2>&1; then
  if [ -f "$HOME/.volta/bin/pnpm" ]; then
    export PATH="$HOME/.volta/bin:$PATH"
  elif [ -f "$HOME/.local/share/pnpm/pnpm" ]; then
    export PATH="$HOME/.local/share/pnpm:$PATH"
  fi
fi

# è¿è¡Œ lint-stagedï¼ˆæ ¼å¼åŒ–ä»£ç ï¼‰
pnpm lint-staged

# è¿è¡Œç±»å‹æ£€æŸ¥ï¼ˆå¿…é¡»é€šè¿‡ï¼‰
echo "ğŸ” Running type check..."
pnpm typecheck || {
  echo "âŒ Type check failed. Please fix the errors before committing."
  exit 1
}

# è¿è¡Œ ESLint æ£€æŸ¥ï¼ˆé›¶è­¦å‘Šï¼‰
echo "ğŸ” Running ESLint..."
pnpm lint || {
  echo "âŒ ESLint check failed. Please fix the errors before committing."
  exit 1
}

echo "âœ… All checks passed!"
